-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.activities (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  empresa_id bigint,
  empreendimento_id bigint,
  funcionario_id bigint,
  diario_obra_id bigint,
  criado_por_usuario_id bigint NOT NULL,
  etapa text,
  tipo_atividade character varying NOT NULL,
  nome text NOT NULL,
  descricao text,
  data_inicio_prevista character varying,
  duracao_dias numeric,
  data_fim_prevista character varying,
  data_inicio_real character varying,
  data_fim_real character varying,
  status character varying DEFAULT 'Não iniciado'::character varying,
  responsavel_texto text,
  dependencies text,
  custom_class text,
  created_at timestamp with time zone DEFAULT now(),
  progresso integer DEFAULT 0,
  CONSTRAINT activities_pkey PRIMARY KEY (id),
  CONSTRAINT activities_diario_obra_id_fkey FOREIGN KEY (diario_obra_id) REFERENCES public.diarios_obra(id),
  CONSTRAINT activities_criado_por_usuario_id_fkey FOREIGN KEY (criado_por_usuario_id) REFERENCES public.usuarios(id),
  CONSTRAINT activities_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.cadastro_empresa(id),
  CONSTRAINT activities_empreendimento_id_fkey FOREIGN KEY (empreendimento_id) REFERENCES public.empreendimentos(id),
  CONSTRAINT activities_funcionario_id_fkey FOREIGN KEY (funcionario_id) REFERENCES public.funcionarios(id)
);
CREATE TABLE public.cadastro_empresa (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  cnpj text NOT NULL UNIQUE,
  razao_social text NOT NULL,
  nome_fantasia text,
  inscricao_estadual text,
  inscricao_municipal text,
  address_street text,
  address_number text,
  address_complement text,
  cep character varying,
  city text,
  state character varying,
  neighborhood text,
  telefone character varying,
  email text,
  responsavel_legal text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT cadastro_empresa_pkey PRIMARY KEY (id)
);
CREATE TABLE public.contatos (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  empresa_id bigint,
  nome text NOT NULL,
  tipo_contato character varying,
  empresa_texto text,
  cargo text,
  email text,
  telefone text,
  address_street text,
  address_number text,
  address_complement text,
  cep character varying,
  city text,
  state character varying,
  neighborhood text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT contatos_pkey PRIMARY KEY (id),
  CONSTRAINT contatos_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.cadastro_empresa(id)
);
CREATE TABLE public.diarios_obra (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  empreendimento_id bigint NOT NULL,
  data_relatorio character varying NOT NULL,
  rdo_numero character varying,
  responsavel_rdo text,
  condicoes_climaticas text,
  condicoes_trabalho text,
  status_atividades text,
  mao_de_obra jsonb,
  ocorrencias_do_dia jsonb,
  fotos_do_dia jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT diarios_obra_pkey PRIMARY KEY (id),
  CONSTRAINT diarios_obra_empreendimento_id_fkey FOREIGN KEY (empreendimento_id) REFERENCES public.empreendimentos(id)
);
CREATE TABLE public.empreendimentos (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  empresa_proprietaria_id bigint NOT NULL,
  nome text NOT NULL UNIQUE,
  address_street text,
  address_number text,
  address_complement text,
  cep character varying,
  city text,
  state character varying,
  neighborhood text,
  data_inicio character varying,
  data_fim_prevista character varying,
  status character varying DEFAULT 'Em Andamento'::character varying,
  valor_total character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT empreendimentos_pkey PRIMARY KEY (id),
  CONSTRAINT empreendimentos_empresa_proprietaria_id_fkey FOREIGN KEY (empresa_proprietaria_id) REFERENCES public.cadastro_empresa(id)
);
CREATE TABLE public.funcionarios (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  empresa_id bigint NOT NULL,
  empreendimento_atual_id bigint,
  full_name text NOT NULL,
  cpf character varying NOT NULL UNIQUE,
  rg character varying,
  birth_date character varying,
  phone character varying,
  email text,
  address_street text,
  address_number text,
  address_complement text,
  cep character varying,
  city text,
  state character varying,
  neighborhood text,
  contract_role text NOT NULL,
  admission_date character varying NOT NULL,
  base_salary character varying,
  total_salary character varying,
  daily_value character varying,
  payment_method text,
  pix_key text,
  bank_details text,
  aso_doc text,
  contract_doc text,
  identity_doc text,
  observations text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT funcionarios_pkey PRIMARY KEY (id),
  CONSTRAINT funcionarios_empreendimento_atual_id_fkey FOREIGN KEY (empreendimento_atual_id) REFERENCES public.empreendimentos(id),
  CONSTRAINT funcionarios_empresa_id_fkey FOREIGN KEY (empresa_id) REFERENCES public.cadastro_empresa(id)
);
CREATE TABLE public.marcas_uploads (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  descricao text,
  caminho_arquivo text NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT marcas_uploads_pkey PRIMARY KEY (id)
);
CREATE TABLE public.materiais (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  empresa_fornecedor_id bigint,
  nome text NOT NULL,
  descricao text,
  unidade_medida text,
  quantidade_estoque character varying,
  preco_unitario character varying,
  fornecedor_texto text,
  address_street text,
  address_number text,
  address_complement text,
  cep character varying,
  city text,
  state character varying,
  neighborhood text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT materiais_pkey PRIMARY KEY (id),
  CONSTRAINT materiais_empresa_fornecedor_id_fkey FOREIGN KEY (empresa_fornecedor_id) REFERENCES public.cadastro_empresa(id)
);
CREATE TABLE public.ocorrencias (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  empreendimento_id bigint NOT NULL,
  atividade_id bigint,
  funcionario_id bigint,
  tipo character varying NOT NULL,
  descricao text NOT NULL,
  data_ocorrencia character varying NOT NULL,
  hora_ocorrencia character varying,
  severidade character varying DEFAULT 'Média'::character varying,
  resolvida boolean DEFAULT false,
  data_resolucao character varying,
  observacoes text,
  created_at timestamp with time zone DEFAULT now(),
  diario_obra_id bigint,
  CONSTRAINT ocorrencias_pkey PRIMARY KEY (id),
  CONSTRAINT ocorrencias_empreendimento_id_fkey FOREIGN KEY (empreendimento_id) REFERENCES public.empreendimentos(id),
  CONSTRAINT fk_diario_obra FOREIGN KEY (diario_obra_id) REFERENCES public.diarios_obra(id),
  CONSTRAINT ocorrencias_funcionario_id_fkey FOREIGN KEY (funcionario_id) REFERENCES public.funcionarios(id),
  CONSTRAINT ocorrencias_atividade_id_fkey FOREIGN KEY (atividade_id) REFERENCES public.activities(id)
);
CREATE TABLE public.pontos (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  funcionario_id bigint NOT NULL,
  data_hora timestamp without time zone NOT NULL,
  tipo_registro text,
  observacao text,
  created_at timestamp without time zone DEFAULT now(),
  CONSTRAINT pontos_pkey PRIMARY KEY (id),
  CONSTRAINT pontos_funcionario_id_fkey FOREIGN KEY (funcionario_id) REFERENCES public.funcionarios(id)
);
CREATE TABLE public.rdo_fotos_uploads (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  diario_obra_id bigint NOT NULL,
  caminho_arquivo text NOT NULL,
  descricao text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT rdo_fotos_uploads_pkey PRIMARY KEY (id),
  CONSTRAINT rdo_fotos_uploads_diario_obra_id_fkey FOREIGN KEY (diario_obra_id) REFERENCES public.diarios_obra(id)
);
CREATE TABLE public.usuarios (
  id bigint GENERATED ALWAYS AS IDENTITY NOT NULL,
  funcionario_id bigint UNIQUE,
  email text NOT NULL UNIQUE,
  password_hash text NOT NULL,
  is_active boolean DEFAULT true,
  is_admin boolean DEFAULT false,
  updated_at timestamp with time zone DEFAULT now(),
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT usuarios_pkey PRIMARY KEY (id),
  CONSTRAINT usuarios_funcionario_id_fkey FOREIGN KEY (funcionario_id) REFERENCES public.funcionarios(id)
);